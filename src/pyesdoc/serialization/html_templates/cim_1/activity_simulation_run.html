{% extends "../core/document.html" %}

{% comment ******************* %}
{% comment Emit navigation     %}
{% comment ******************* %}
{% block doc-nav %}
    <li><a href="#{{ doc.ext.full_id }}-overview">Overview</a></li>
    {% set contacts = [rp for rp in doc.responsible_parties if rp.role.lower() not in ['funder', 'centre']] %}
	{% if len(contacts) %}
	    <li><a href="#{{ doc.ext.full_id }}-contacts">Contacts</a></li>
    {% end %}
	{% if len(doc.inputs) %}
	    <li><a href="#{{ doc.ext.full_id }}-inputs">Inputs</a></li>
    {% end %}
{% end %}

{% comment ***************** %}
{% comment Emit content      %}
{% comment ***************** %}
{% block doc-content %}

	{% comment ***************** %}
	{% comment Emit overview     %}
	{% comment ***************** %}
	{% set ctx = TemplateInfo(doc,
		header = "Overview",
		fieldset = [
		    FieldInfo('Project', path='meta.project'),
		    FieldInfo('Institute', path='meta.institute'),
	        FieldInfo('Name', path='short_name'),
	        FieldInfo('Long Name', path='long_name'),	        	        FieldInfo('ID', path='simulation_id'),	        FieldInfo('Experiment', path='supports_references[0].name'),
	        FieldInfo('Experiment conformances', path='ext.conformances'),
			FieldInfo('Authors', path='authors'),
	        FieldInfo('Funder', path='responsible_parties.role=funder.organisation_name', link_path='responsible_parties.role=funder.contact_info.url'),
	        FieldInfo('RIP Value', path='simulation_id'),
	        FieldInfo('Spinup start', path='spinup_date_range.start'),
	        FieldInfo('Spinup duration', path='spinup_date_range.duration'),
		],
		tag_id = doc.ext.full_id + "-overview",
		template = "fieldset_table.html"
	) %}
	{% include ../core/section_01.html %}

	{% comment ***************** %}
	{% comment Emit inputs   %}
	{% comment ***************** %}
	{% if len(doc.inputs) %}
		{% set ctx = TemplateInfo(doc.inputs,
			tag_id = doc.ext.full_id + '-',
			header = "Couplings",
			template = "cim_1_activity_simulation_input.html"
		) %}
		{% include ../core/section_02.html %}
	{% end %}

	{% comment ***************** %}
	{% comment Emit conformances %}
	{% comment ***************** %}
	{% if len(doc.conformances) %}
		{% set ctx = TemplateInfo(doc.conformances,
			tag_id = doc.ext.full_id + '-',
			header = "Conformances",
			template = "cim_1_activity_simulation_conformance.html"
		) %}
		{% include ../core/section_02.html %}
	{% end %}

	{% comment ***************** %}
	{% comment Emit model mods   %}
	{% comment ***************** %}
	{% if doc.model_reference and len(doc.model_reference.changes) %}
		{% set changeset = [c for c in doc.model_reference.changes if len(c.details)] %}
		{% if len(changeset) %}


		{% set ctx = TemplateInfo(doc,
			fieldset_type = "property",
			header = "Model Modifications",
			tag_id = doc.ext.full_id + "-model-mods",
			template = "fieldset_table.html"
		) %}
		{% for change_property in changeset %}
			{% raw ctx.fieldset.append(FieldInfo(change_property.name, value=change_property.details[0].description)) or "" %}
		{% end %}
		{% include ../core/section_01.html %}

		{% end %}
	{% end %}

	{% comment ***************** %}
	{% comment Emit contacts     %}
	{% comment ***************** %}
	{% set ctx = TemplateInfo([rp for rp in doc.responsible_parties if rp.role.lower() not in ['funder', 'centre']],
		header = "Contacts",
		tag_id = doc.ext.full_id + "-contacts",
		template = "cim_1_shared_responsible_party.html"
	) %}
	{% include ../core/section_01.html %}

{% end %}