{% extends "../core/document.html" %}

{% comment ******************* %}
{% comment Emit navigation     %}
{% comment ******************* %}
{% block doc-nav %}
	{% comment Set helper vars %}
	{% set simulation = doc.simulation %}

    <li><a href="#{{ doc.ext.full_id }}-overview">Overview</a></li>
    <li><a href="#{{ doc.ext.full_id }}-couplings">Couplings</a></li>
	{% if simulation.model_reference and simulation.model_reference.changes %}
	    <li><a href="#{{ doc.ext.full_id }}-model-mods">Model Mods</a></li>
	{% end %}
{% end %}

{% comment ***************** %}
{% comment Emit content      %}
{% comment ***************** %}
{% block doc-content %}

	{% comment Set helper vars %}
	{% set data = doc.data %}
	{% set ensembles = doc.ensembles %}
	{% set experiment = doc.experiment %}
	{% set grids = doc.grids %}
	{% set model = doc.model %}
	{% set platform = doc.platform %}
	{% set simulation = doc.simulation %}

	{% comment ***************** %}
	{% comment Emit overview     %}
	{% comment ***************** %}
	{% set ctx = TemplateInfo(doc,
		header = "Overview",
		tag_id = doc.ext.full_id + "-overview",
		template = "cim_1_misc_document_set_overview.html"
	) %}
	{% include ../core/section_02.html %}

	{% comment ***************** %}
	{% comment Emit Couplings   %}
	{% comment ***************** %}
	{% if len(simulation.inputs) %}
		{% set ctx = TemplateInfo(simulation.inputs,
			tag_id = simulation.ext.full_id + '-couplings',
			tag_css = simulation.type_key.lower().replace(".", "-") + '-couplings',
			header = "Couplings",
			template = "cim_1_activity_simulation_input.html"
		) %}
		{% include ../core/section_02.html %}
	{% end %}

	{% comment ***************** %}
	{% comment Emit model mods   %}
	{% comment ***************** %}
	{% if simulation.model_reference and len(simulation.model_reference.changes) %}
		{% set changeset = [c for c in simulation.model_reference.changes if len(c.details)] %}
		{% if len(changeset) %}
		{% set ctx = TemplateInfo(doc,
			fieldset_type = "property",
			header = "Model Modifications",
			tag_id = simulation.ext.full_id + "-model-mods",
			template = "fieldset_table.html"
		) %}
		{% for change_property in changeset %}
			{% raw ctx.fieldset.append(FieldInfo(change_property.name, value=change_property.details[0].description)) or "" %}
		{% end %}
		{% include ../core/section_01.html %}

		{% end %}
	{% end %}

{% end %}
